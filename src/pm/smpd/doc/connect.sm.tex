\begin{comment}
This is the state machine for the smpd connect command.
Graph [smpd connect],
      [size="7.5, 10"]
\end{comment}
\begin{verbatim}
State [connecting],[label="connecting"]
	Event [connect]
		Change_State([reading challenge string], [label="connect"])
State [reading challenge string],[label="reading challenge string"]
	Event [data read]
		Change_State([writing challenge response])
State [writing challenge response],[label="writing challenge response"]
	Event [data written]
		Change_State([reading connect result])
State [reading connect result],[label="reading connect result"]
	Event [data read]
		if accept
			Change_State([writing process session request],[label="accept"])
		else reject
			Change_State([closing],[label="reject"])
State [writing process session request],[label="writing process session request"]
	Event [data written]
		Change_State([reading cred request])
State [reading cred request],[label="reading cred request"]
	Event [data read]
		if yes
			Invoke_Action([have credentials],[label="yes"])
		else no
			Change_State([reading reconnect request], [label="no"])
Action [have credentials],[label="have credentials"]
	if have
		Change_State([writing cred ack yes],[label="yes"])
	if have sspi
		Change_State([writing cred ack sspi],[label="sspi"])
	else don't have
		Change_State([writing cred_request command],[label="no"])
State [writing cred_request command],[label="writing cred_request command"]
	Event [data written]
		Change_State([handle result],[style=dotted])
State [handle result]
	Event [data read]
		if success
			Change_State([writing cred ack yes],[label="success"])
		else fail
			Change_State([writing cred ack no],[label="fail"])
State [writing cred ack sspi]
        Event [data written]
                Change_State([writing sspi setup])
State [writing sspi setup]
        Event [data written]
                Change_State([handle sspi result],[style=dotted])
State [handle sspi result]
        Event [data read]
                if success
                        Change_State([reading reconnect request],[label="success"])
                else fail
                        Change_State([closing],[label="fail"])
State [writing cred ack yes],[label="writing cred ack yes"]
	Event [data written]
		Change_State([writing account])
State [writing cred ack no],[label="writing cred ack no"]
	Event [data written]
		Change_State([closing])
State [writing account],[label="writing account"]
	Event [data written]
		Change_State([writing password])
State [writing password],[label="writing password"]
	Event [data written]
		Change_State([reading password result])
State [reading password result],[label="reading password result"]
	Event [data read]
		if accept
			Change_State([reading reconnect request],[label="accept"])
		else reject
			Change_State([closing],[label="reject"])
State [reading reconnect request],[label="reading reconnect request"]
	Event [data read]
		if yes
			Change_State([closing],[label="yes"])
			Change_State([reconnecting],[label="yes" style=dotted])
		else no
			Change_State([writing session header], [label="no"])
State [reconnecting],[label="reconnecting"]
	Event [connect]
		Change_State([writing session header],[label="connect"])
State [writing session header],[label="writing session header"]
	Event [data written]
		Change_State([reading and writing],[label="post result cmd"])
State [reading and writing],[label="reading cmd header and writing cmd"]
	Event [data read]
		Change_State([reading cmd],[label="read"])
	Event [data written]
		Change_State([reading cmd header],[label="result written"])
State [reading cmd header],[label="reading cmd header"]
	Event [data read]
		Change_State([reading cmd])
State [reading cmd],[label="reading cmd"]
	Event [data read]
		Invoke_Action([handle cmd])
Action [handle cmd],[label="handle cmd"]
State [closing],[label="closing"]
	Event [closed]
		Change_State([done], [label="closed"])
State [done],[label="done"]
\end{verbatim}
