CC          = @CC@
INCLUDE_DIR = -I@MPI_INCLUDE_DIR@ -I../../include -I../../adio/include
AR          = @AR@
RANLIB      = @RANLIB@
LIBNAME     = @LIBNAME@
CFLAGS      = @CFLAGS@ $(MPIOPROFILE) $(INCLUDE_DIR)

MPIO_FOBJECTS = closef.o readf.o openf.o writef.o get_extentf.o \
      ireadf.o iwritef.o iotestf.o iowaitf.o seekf.o \
      deletef.o read_allf.o read_atf.o \
      read_atallf.o iread_atf.o iwrite_atf.o get_posnf.o \
      write_allf.o write_atf.o write_atallf.o get_bytofff.o \
      set_viewf.o get_viewf.o get_groupf.o get_amodef.o \
      fsyncf.o get_atomf.o set_atomf.o set_infof.o get_infof.o \
      set_sizef.o get_sizef.o preallocf.o

MPIO_TMP_PFOBJECTS = closef.p readf.p openf.p writef.p get_extentf.p \
      ireadf.p iwritef.p iotestf.p iowaitf.p seekf.p \
      deletef.p read_allf.p read_atf.p \
      read_atallf.p iread_atf.p iwrite_atf.p get_posnf.p \
      write_allf.p write_atf.p write_atallf.p get_bytofff.p \
      set_viewf.p get_viewf.p get_groupf.p get_amodef.p \
      fsyncf.p get_atomf.p set_atomf.p set_infof.p get_infof.p \
      set_sizef.p get_sizef.p preallocf.p

MPIO_REAL_PFOBJECTS = _closef.o _readf.o _openf.o _get_extentf.o \
      _writef.o _set_viewf.o _seekf.o _read_atf.o \
      _ireadf.o _iwritef.o _iotestf.o _iowaitf.o _get_posnf.o \
      _deletef.o _read_allf.o \
      _read_atallf.o _iread_atf.o _iwrite_atf.o _get_bytofff.o \
      _write_allf.o _write_atf.o _write_atallf.o _get_viewf.o \
      _get_groupf.o _get_amodef.o _fsyncf.o _get_atomf.o _set_atomf.o \
      _set_sizef.o _get_sizef.o _preallocf.o _set_infof.o _get_infof.o

all: $(LIBNAME)

.SUFFIXES: $(SUFFIXES) .p

.c.o:
	$(CC) $(CFLAGS) -c $*.c

.c.p:
	@cp $*.c _$*.c
	$(CC) $(CFLAGS) -c _$*.c
	@rm -f _$*.c

profile: $(MPIO_TMP_PFOBJECTS)
	$(AR) $(LIBNAME) $(MPIO_REAL_PFOBJECTS)
	@rm -f _*.o

$(LIBNAME): $(MPIO_FOBJECTS)
	$(AR) $(LIBNAME) $(MPIO_FOBJECTS)

clean: 
	@rm -f *.o
