ALL: all-redirect
SHELL = @SHELL@
VPATH = @srcdir@
srcdir = @srcdir@
.SUFFIXES: .pdf .ps .dvi .tex

# The tests on files that use -s really need to also check for a valid
# link.  However, the -h test is not available in all shells,
# so we allow the ln to fail without exiting make (the -f option for
# ln is also non-standard, so we can't use that either)
.tex.dvi:
	@-if [ ! -s ../mpiman.sty ] ; then \
	(cd .. && ln -s $(srcdir)/../mpiman.sty mpiman.sty) ; fi
	@-if [ ! -s code.sty ] ; then \
	ln -s $(srcdir)/../refman/code.sty code.sty ; fi
	@if [ ! -s user.bib ] ; then \
	 ln -s $(srcdir)/user.bib user.bib ; fi
	-latex $< </dev/null >/dev/null 2>&1
	-bibtex $* </dev/null
	-latex $< </dev/null >/dev/null 2>&1
	latex $<

.dvi.pdf:
	dvipdfm $*
.dvi.ps:
	dvips $*

# Use latex2html to create the HTML version.  There are several 
# steps needed to workaround features of latex2html
# 1. latex2html needs the user.aux file, so we run a latex step if
#    necessary
# 2. latex2html is not compatible with VPATH builds (it runs in the
#    directory that contains the source file), so we copy the source
#    file.  If more source files are added, this step will need to 
#    be changed
user.aux: $(srcdir)/user.tex
	latex $(srcdir)/user.tex
user/user.html: user.aux $(srcdir)/user.tex $(srcdir)/user.bib
	if [ ! -s user.tex -a -s $(srcdir)/user.tex ] ; then cp $(srcdir)/user.tex . ; fi
	latex2html user.tex

all-redirect: user.pdf

mandoc:

htmldoc:

latexdoc: ALL

clean:
	-rm -f *.toc *.out *.dvi user.ps user.pdf *.aux *.blg *.bbl

distclean: clean
	-rm -f code.sty
