SUBDIRS = . src examples test
# The all-local target makes sure that when different subsystems are selected
# for the configure step, the libraries are removed and the object files 
# cleaned out.  Without this step, it is possible to run make and encounter
# errors caused by out-of-date objects in the directories and in the 
# library
all-local:
	if [ ! -d lib ] ; then mkdir lib ; \
	else \
	    echo "@subsystems@" > lib/pkglist.new ; \
	    if diff lib/pkglist lib/pkglist.new >/dev/null 2>&1 ; then \
	        rm -f lib/pkglist.new ; \
            else \
	        rm -f lib/lib${MPILIBNAME}.a lib/libp${MPILIBNAME}.a ; \
		rm -f lib/pkglist ; \
	        mv -f lib/pkglist.new lib/pkglist ;\
		${MAKE} clean ; \
	    fi ; \
	fi
all-preamble:
	@echo "Beginning make"
all-postamble:
	@echo "Make completed"
distclean-local:
	-@rm -f lib/lib${MPILIBNAME}.a lib/pkglist lib/pkglist.new
	-@rm -f src/include/${MPILIBNAME}conf.h

# Build a distribution tarfile
#  Extract into a temporary directory
#  Rename the directory
#  Run updatefiles with distribution options
#  Tar it up
PACKAGE = mpich2
VERSION = 0.1
dist:
	if [ ! -d tmpdir ] ; then mkdir tmpdir ; fi
#	if [ ! -d tmpdir/${PACKAGE}-${VERSION} ] ; then mkdir tmpdir/${PACKAGE}-${VERSION} ; fi
	(cd tmpdir && cvs -d /home/MPI/cvsMaster export -D now mpich2all )
	mv tmpdir/mpich2 tmpdir/${PACKAGE}-${VERSION}
	(cd tmpdir/${PACKAGE}-${VERSION} && maint/updatefiles )
	(cd tmpdir/${PACKAGE}-${VERSION} && maint/updatefiles -distrib )
	(cd tmpdir/${PACKAGE}-${VERSION}/doc && /bin/rm -rf notes )
	(cd tmpdir/${PACKAGE}-${VERSION}/doc/adi3 && make )
	(cd tmpdir/${PACKAGE}-${VERSION}/doc/mpich2 && make )
	(cd tmpdir && tar cf ${PACKAGE}-${VERSION}.tar ${PACKAGE}-${VERSION} )
	mv tmpdir/${PACKAGE}-${VERSION}.tar .
	-rm -rf tmpdir

# Set the document sources and types (empty lists still cause recursion)
doc_HTML_SOURCES  =
doc_MAN_SOURCES   = 
doc_LATEX_SOURCES = 

install_LIB = lib/lib${MPILIBNAME}.a
install_INCLUDE = src/include/mpi.h
optinstall_LIB = lib/libp${MPILIBNAME}.a
optinstall_SHLIB = lib/lib${MPILIBNAME}.so
# Some of the subsidiary packages may need to be installed.  This target will
# invoke their install targets as part of the installation process
INSTALL_SUBDIRS = src/pmi/impls/@pmi_name@
#install_DOC = 
#install_HTML = 
#install_MAN = 
#install_BIN = 
#install_SBIN = 	
